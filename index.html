<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For My Anabel ‚ù§Ô∏è Valentine's Day 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
            overflow: hidden;
        }

        #gameContainer {
            width: 100%;
            max-width: 450px;
            height: 100vh;
            max-height: 800px;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            border: 3px solid #ff4d6d;
        }

        #screen {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        .stage {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .stage.active {
            display: flex;
        }

        /* ALL images auto-resize to fit device */
        .stage[style*="background-image"] {
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }

        /* ONLY for WOS image - show full image */
        #stage9 {
            background-size: contain !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            background-color: black;
        }

        /* ONLY for Batman image - compact size */
        #stage10 {
            background-size: contain !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            background-color: black;
        }

        /* ONLY for Messages video - show full video */
        #stage12 video {
            object-fit: contain !important;
            background: black;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Map videos fill screen */
        #stage2 video, #stage6 video {
            object-fit: cover !important;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Heartbeat image - compact size */
        #stage11 .heartbeat-image {
            width: auto;
            height: auto;
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: heartbeat 1.2s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: translate(-50%, -50%) scale(1); }
            25% { transform: translate(-50%, -50%) scale(1.08); }
            35% { transform: translate(-50%, -50%) scale(1); }
            45% { transform: translate(-50%, -50%) scale(1.04); }
            55% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Tap animation for images */
        .tap-effect {
            animation: tapPop 0.2s ease;
        }

        @keyframes tapPop {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Restart button */
        .restart-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            border: 2px solid #ff4d6d;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #ff4d6d;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(255, 77, 109, 0.3);
        }

        .restart-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .restart-btn:active {
            transform: scale(0.95);
        }

        /* Message boxes */
        .message-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            color: #333;
            box-shadow: 0 10px 30px rgba(255, 77, 109, 0.5);
            border: 3px solid #ff4d6d;
            max-height: 70%;
            overflow-y: auto;
            width: auto;
            max-width: 90%;
            word-wrap: break-word;
            z-index: 20;
        }

        /* Grid for chocolate day */
        .grid-3x3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            height: auto;
            max-height: 60%;
            aspect-ratio: 1/1;
            margin: auto;
            width: 100%;
            max-width: 350px;
            z-index: 20;
            position: relative;
        }

        .grid-item {
            background-size: cover;
            background-position: center;
            background-image: url('images/chocolate-day/ferrero.png');
            border-radius: 10px;
            box-shadow: 0 0 15px gold;
            cursor: pointer;
            transition: all 0.3s;
            aspect-ratio: 1/1;
        }

        .grid-item.clicked {
            opacity: 0.5;
            box-shadow: none;
        }

        .grid-item.message {
            box-shadow: 0 0 25px #ff4d6d, 0 0 40px #ff69b4;
        }

        /* Floating messages */
        .floating-message {
            position: absolute;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(255,77,109,0.3);
            font-size: clamp(12px, 3vw, 14px);
            animation: float 3s ease-in-out infinite;
            border: 2px solid #ff4d6d;
            cursor: pointer;
            max-width: min(150px, 40%);
            z-index: 50;
            word-wrap: break-word;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Word puzzle */
        .word-puzzle {
            background: rgba(0,0,0,0.7);
            padding: clamp(10px, 3vw, 15px);
            border-radius: 10px;
            margin: 10px;
            z-index: 50;
            position: relative;
            width: 90%;
            max-width: 350px;
            align-self: center;
        }

        .puzzle-input {
            display: flex;
            justify-content: center;
            gap: clamp(5px, 2vw, 10px);
            flex-wrap: wrap;
        }

        .puzzle-letter {
            width: clamp(40px, 12vw, 50px);
            height: clamp(40px, 12vw, 50px);
            text-align: center;
            font-size: clamp(20px, 6vw, 30px);
            border: 3px solid #ff4d6d;
            border-radius: 10px;
            background: white;
            text-transform: uppercase;
        }

        /* Buttons */
        .btn {
            background: #ff4d6d;
            color: white;
            border: none;
            padding: clamp(12px, 4vw, 15px) clamp(25px, 8vw, 40px);
            font-size: clamp(16px, 5vw, 20px);
            border-radius: 50px;
            margin: 10px;
            cursor: pointer;
            box-shadow: 0 5px 0 #b30f2e;
            transition: all 0.1s;
            font-weight: bold;
            letter-spacing: 2px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            white-space: nowrap;
            z-index: 30;
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #b30f2e;
        }

        .btn-small {
            padding: clamp(8px, 2.5vw, 10px) clamp(15px, 5vw, 25px);
            font-size: clamp(14px, 4vw, 16px);
        }

        /* Title text */
        .title {
            color: white;
            text-shadow: 3px 3px 0 #ff4d6d;
            font-size: clamp(20px, 6vw, 28px);
            text-align: center;
            margin-bottom: 20px;
            word-wrap: break-word;
        }

        /* Shiny text with heartbeat for LOOK AT ME */
        .look-at-me {
            font-size: clamp(40px, 12vw, 70px);
            font-weight: bold;
            text-align: center;
            background: linear-gradient(90deg, #ffd700, #ff69b4, #ff4d6d, #ffd700);
            background-size: 300% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shineFlash 1.5s linear infinite, heartbeatStrong 0.8s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 105, 180, 0.9);
            letter-spacing: 8px;
            word-wrap: break-word;
            padding: 0 10px;
            z-index: 30;
            position: relative;
            display: inline-block;
            width: 100%;
            line-height: 1.2;
        }

        @keyframes shineFlash {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        @keyframes heartbeatStrong {
            0% { transform: scale(1); opacity: 0.9; }
            25% { transform: scale(1.15); opacity: 1; }
            35% { transform: scale(1); opacity: 0.9; }
            45% { transform: scale(1.08); opacity: 1; }
            55% { transform: scale(1); opacity: 0.9; }
            100% { transform: scale(1); opacity: 0.9; }
        }

        /* Center container for LOOK AT ME */
        .center-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
            z-index: 30;
            padding: 0 20px;
        }

        /* Golden ribbon */
        #goldenRibbon {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            background: linear-gradient(90deg, gold, #ffd700, gold);
            padding: clamp(8px, 2vh, 10px) 0;
            display: none;
            overflow: hidden;
            z-index: 40;
        }

        #goldenRibbon p {
            color: white;
            font-weight: bold;
            animation: slide 10s linear infinite;
            white-space: nowrap;
            font-size: clamp(14px, 4vw, 16px);
        }

        @keyframes slide {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Emoji shower */
        .emoji-shower {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .emoji {
            position: absolute;
            font-size: clamp(20px, 8vw, 30px);
            animation: fall linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(100vh); }
        }

        /* Mode toggle button */
        .mode-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4d6d;
            color: white;
            border: none;
            padding: clamp(5px, 2vh, 8px) clamp(10px, 3vw, 15px);
            border-radius: 20px;
            font-size: clamp(12px, 3.5vw, 14px);
            z-index: 200;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Cloud overlay */
        .cloud-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            background: rgba(255, 255, 255, 0);
            transition: background 0.3s;
        }

        .cloud-overlay.active {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Responsive */
        @media (max-width: 350px) {
            .btn { padding: 10px 20px; font-size: 14px; }
            .floating-message { font-size: 11px; padding: 5px 10px; }
            .puzzle-letter { width: 35px; height: 35px; font-size: 18px; }
            .look-at-me { font-size: 35px; letter-spacing: 4px; }
        }

        button {
            min-height: 44px;
            min-width: 44px;
        }

        /* Manual button mode styles */
        .button-mode-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }

        .answer-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Press & Hold button styles */
        .press-hold-btn {
            background: #ff4d6d;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 60px;
            box-shadow: 0 5px 0 #b30f2e;
            cursor: pointer;
            transition: all 0.1s;
            font-weight: bold;
            letter-spacing: 2px;
            width: 80%;
            max-width: 300px;
            margin: 20px auto;
            display: block;
        }

        .press-hold-btn:active {
            transform: scale(0.95);
            background: #4CAF50;
        }

        .press-hold-btn.listening {
            background: #4CAF50;
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Audio players -->
        <audio id="song1" loop>
            <source src="audio/song1.mp3" type="audio/mpeg">
        </audio>
        <audio id="song2" loop>
            <source src="audio/song2.mp3" type="audio/mpeg">
        </audio>
        <audio id="song3" loop>
            <source src="audio/song3.mp3" type="audio/mpeg">
        </audio>

        <div id="screen">
            <!-- Cloud overlay -->
            <div id="cloudOverlay" class="cloud-overlay"></div>

            <!-- STAGE 1: Confrontation -->
            <div id="stage1" class="stage active" style="background: linear-gradient(145deg, #1a1a2e, #16213e);">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;">
                    <h1 class="title" style="font-size: 28px; margin-bottom: 40px; color: white;">This is the Valentine's Day 2026 sweet gift to my lovely Anabel by her lovely Harsh</h1>
                    <h2 class="title" style="font-size: 48px; margin-bottom: 60px; color: #ff4d6d; text-shadow: 0 0 20px #ff4d6d;">Are you ready?</h2>
                    <button class="btn" onclick="startGame()">YES, I'M READY ‚ù§Ô∏è</button>
                </div>
            </div>

            <!-- STAGE 2: World Map zoom Spain -->
            <div id="stage2" class="stage">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <video autoplay muted onended="cloudTransition(2, 4)">
                    <source src="images/2-world-map.mp4" type="video/mp4">
                </video>
                <div style="position: absolute; bottom: 50px; left: 0; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 20;">
                    <div class="message-box" style="background: rgba(255,255,255,0.9);">
                        <p style="font-size: 24px; text-align: center;">üìç Torrent, Spain</p>
                        <p style="text-align: center;">Where your journey began...</p>
                    </div>
                </div>
            </div>

            <!-- STAGE 3: Cloud cover -->
            <div id="stage3" class="stage" style="background: white;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
            </div>

            <!-- STAGE 4: Ana pic - Button top left -->
            <div id="stage4" class="stage" style="background-image: url('images/4-ana-pixel.png');">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                
                <!-- Read Message button - TOP LEFT corner -->
                <button class="btn" onclick="showMessage('ana')" style="position: absolute; top: 80px; left: 20px; z-index: 30;">Read Message</button>
                
                <!-- Message box - centered -->
                <div class="message-box" id="anaMessageBox" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100;">
                    <p id="anaMessage">My beautiful Ana... I love you, i love you a lot, i love you the most. and ofc i love you more. you make my heart feel at home, you make my smile feel a bit warm, you make my day as pretty as you and you make live as beautiful as you, on this valentine's day i wish i get a pretty smile on your face because you deserve it all! ‚ù§Ô∏è</p>
                    <button class="btn btn-small" onclick="closeMessage('ana')">‚ù§Ô∏è</button>
                </div>
                
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 20;" onclick="cloudTransition(4, 6)">Continue</button>
            </div>

            <!-- STAGE 5: Cloud cover 2 -->
            <div id="stage5" class="stage" style="background: white;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
            </div>

            <!-- STAGE 6: India map -->
            <div id="stage6" class="stage">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <video autoplay muted onended="cloudTransition(6, 8)">
                    <source src="images/5-india-map.mp4" type="video/mp4">
                </video>
                <div style="position: absolute; bottom: 50px; left: 0; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 20;">
                    <div class="message-box" style="background: rgba(255,255,255,0.9);">
                        <p style="font-size: 24px; text-align: center;">üìç India</p>
                        <p style="text-align: center;">Where my heart beats for you...</p>
                    </div>
                </div>
            </div>

            <!-- STAGE 7: Cloud cover 3 -->
            <div id="stage7" class="stage" style="background: white;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
            </div>

            <!-- STAGE 8: Harsh pic - Button top left -->
            <div id="stage8" class="stage" style="background-image: url('images/7-harsh-pixel.png');">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                
                <!-- Read Message button - TOP LEFT corner -->
                <button class="btn" onclick="showMessage('harsh')" style="position: absolute; top: 80px; left: 20px; z-index: 30;">Read Message</button>
                
                <!-- Message box - centered -->
                <div class="message-box" id="harshMessageBox" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100;">
                    <p id="harshMessage">Your Harsh... The man who was just moving through life, unknown to what holds next, a bit silly, a bit confused. That found you and just cant get off you no moreeeee... (a leach if that sounds good. but a good one). The man who looks at you not as a girlfriend but as the most beautiful creation of God, and no i am not silly saying this!! üíï</p>
                    <button class="btn btn-small" onclick="closeMessage('harsh')">‚ù§Ô∏è</button>
                </div>
                
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 20;" onclick="nextStage(8)">Continue</button>
            </div>

            <!-- STAGE 9: WOS image - FULL SIZE (CONTAIN) -->
            <div id="stage9" class="stage" style="background-image: url('images/8-wos.png'); background-size: contain; background-position: center; background-repeat: no-repeat; background-color: black;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 20;" onclick="nextStage(9)">Continue</button>
            </div>

            <!-- STAGE 10: Batman imagine - COMPACT SIZE (CONTAIN) -->
            <div id="stage10" class="stage" style="background-image: url('images/9-batman.png'); background-size: contain; background-position: center; background-repeat: no-repeat; background-color: black;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 20;" onclick="nextStage(10)">Continue</button>
            </div>

            <!-- STAGE 11: Heartbeat - compact size -->
            <div id="stage11" class="stage">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <img src="images/12-heartbeat.png" class="heartbeat-image" alt="Heartbeat">
                <div style="position: absolute; top: 20px; left: 0; width: 100%; text-align: center; z-index: 20;">
                    <h1 class="title" style="font-size: 36px; color: white; text-shadow: 0 0 20px red; background: rgba(0,0,0,0.3); display: inline-block; padding: 10px 30px; border-radius: 50px;">NO GOING BACK</h1>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index:20;" onclick="nextStage(11)">Continue</button>
            </div>

            <!-- STAGE 12: Messages slideshow - FULL VIDEO (CONTAIN) -->
            <div id="stage12" class="stage">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <video autoplay muted loop style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; background: black; z-index: 1;">
                    <source src="images/13-messages-bg.mp4" type="video/mp4">
                </video>
                <div style="flex:1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 10;">
                    <div class="message-box" id="slideshowMessage" style="background: rgba(255,255,255,0.95); max-width: 80%;">
                        <p id="currentMessage" style="font-size: 18px; line-height: 1.6;">Message 1 of your beautiful words...</p>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        <button class="btn-small" onclick="prevMessage()" style="margin: 5px;">‚Üê Previous</button>
                        <button class="btn-small" onclick="nextMessage()" style="margin: 5px;">Next ‚Üí</button>
                    </div>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 20;" onclick="startValentineWeek()">Begin Valentine's Week ‚ù§Ô∏è</button>
            </div>

            <!-- STAGE 13: Rose Day -->
            <div id="stage13" class="stage" style="background-image: url('images/rose-day/lavender-empty.png');">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div style="position: absolute; top: 20px; left: 0; width: 100%; text-align: center; z-index: 50;">
                    <button class="btn" id="waterBtn" onclick="waterFlowers()">üíß Water them</button>
                </div>
                <div id="rosePopup" class="message-box" style="display: none; position: relative; z-index: 100;">
                    <p id="roseMessage"></p>
                    <button class="btn-small" onclick="continueWatering()">Continue watering</button>
                </div>
                <div id="goldenRibbon" style="position: absolute; top: 80px; left: 0; width: 100%; background: linear-gradient(90deg, gold, #ffd700, gold); padding: 10px 0; display: none; overflow: hidden; z-index: 40;">
                    <p style="color: white; font-weight: bold; animation: slide 10s linear infinite; white-space: nowrap;">üíï I love you more than all the flowers in the world üíï</p>
                </div>
                <button class="btn-small" id="nextDayBtn" style="position: absolute; bottom: 20px; right: 20px; display: none; z-index: 20;" onclick="nextDay(13)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 14: Propose Day -->
            <div id="stage14" class="stage" style="background-image: url('images/propose-day/propose.png');">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <!-- Messages in corners only -->
                <div id="messageBox1" class="floating-message" style="top: 10%; left: 5%;" onclick="expandMessage(1)">"You are....."</div>
                <div id="messageBox2" class="floating-message" style="top: 10%; right: 5%;" onclick="expandMessage(2)">"i remember the....."</div>
                <div id="messageBox3" class="floating-message" style="bottom: 15%; left: 5%;" onclick="expandMessage(3)">"you make me....."</div>
                <div id="messageBox4" class="floating-message" style="bottom: 15%; right: 5%;" onclick="expandMessage(4)">"My most....."</div>
                <div id="messageBox5" class="floating-message" style="top: 50%; left: 5%; transform: translateY(-50%);" onclick="expandMessage(5)">"forever is just....."</div>
                
                <div id="expandedMessageBox" class="message-box" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; z-index: 200;">
                    <p id="expandedMessageText"></p>
                    <button class="btn-small" onclick="closeExpandedMessage()">‚ù§Ô∏è</button>
                </div>
                
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 100;" onclick="nextDay(14)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 15: Chocolate Day -->
            <div id="stage15" class="stage" style="background: #fff0f5;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div class="grid-3x3" id="chocolateGrid"></div>
                <div id="chocoMessageBox" class="message-box" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 200;">
                    <p id="chocoMessage"></p>
                    <button class="btn-small" onclick="closeChocoMessage()">‚ù§Ô∏è Check Another</button>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 100;" onclick="nextDay(15)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 16: Teddy Day - Puzzle will hide after solve -->
            <div id="stage16" class="stage" style="background-image: url('images/teddy-day/teddy.png');">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div class="word-puzzle">
                    <h3 style="color: white; text-align: center;">4 _ _ _ _</h3>
                    <div class="puzzle-input">
                        <input type="text" class="puzzle-letter" id="letter1" maxlength="1" onkeyup="checkPuzzle()">
                        <input type="text" class="puzzle-letter" id="letter2" maxlength="1" onkeyup="checkPuzzle()">
                        <input type="text" class="puzzle-letter" id="letter3" maxlength="1" onkeyup="checkPuzzle()">
                        <input type="text" class="puzzle-letter" id="letter4" maxlength="1" onkeyup="checkPuzzle()">
                    </div>
                </div>
                
                <div id="teddyVideo" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                    <video loop autoplay muted style="object-fit: cover; width: 100%; height: 100%;">
                        <source src="images/teddy-day/teddy-video.mp4" type="video/mp4">
                    </video>
                </div>
                
                <div id="floatingMessages" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
                
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px; z-index: 100;" onclick="nextDay(16)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 17: Promise Day - Tap image with animation -->
            <div id="stage17" class="stage" style="background-image: url('images/promise-day/promise.png'); cursor: pointer;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div style="flex:1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div class="message-box" id="promiseMessageBox" style="display: none;">
                        <p id="promiseText"></p>
                        <button class="btn-small" onclick="closePromiseMessage()">‚ù§Ô∏è</button>
                    </div>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px;" onclick="nextDay(17)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 18: Hug Day - Anonymous tapping with animation -->
            <div id="stage18" class="stage" style="background-image: url('images/hug-day/hug.png'); cursor: pointer;">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div style="position: absolute; top: 20px; left: 0; width: 100%; text-align: center; z-index: 10;">
                    <p style="color: white; margin-bottom: 20px; background: rgba(255,77,109,0.7); padding: 10px; border-radius: 20px; display: inline-block;" id="hugCounter">Tap the image for hugs! ü§ó</p>
                </div>
                
                <div style="flex:1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div class="message-box" id="hugMessageBox" style="display: none;">
                        <p id="hugText"></p>
                        <button class="btn-small" onclick="closeHugMessage()">‚ù§Ô∏è</button>
                    </div>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px;" onclick="nextDay(18)">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 19: Kiss Day - FIXED: LOOK AT ME centered with heartbeat -->
            <div id="stage19" class="stage" style="background: linear-gradient(145deg, #1a1a2e, #16213e);">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <div class="center-text">
                    <div class="look-at-me">LOOK AT ME</div>
                </div>
                <button class="btn-small" style="position: absolute; bottom: 20px; right: 20px;" onclick="goToValentinesDay()">Next Day ‚Üí</button>
            </div>

            <!-- STAGE 20: Valentine's Day Q&A - FIXED with Press & Hold button -->
            <div id="stage20" class="stage" style="background: linear-gradient(145deg, #ff4d6d, #b30f2e);">
                <div class="restart-btn" onclick="restartCurrentDay(event)">‚ü≥</div>
                <button id="modeToggle" class="mode-toggle" onclick="toggleMode()">üëÜ Button Mode</button>
                
                <div style="flex:1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;">
                    <div id="questionBox" class="message-box" style="width: 100%;">
                        <h2 id="questionText">Do you oath to be truthful with your answer?</h2>
                        <p id="answerHint" style="color: #666; margin: 10px 0;">Press and hold the button below to speak your answer</p>
                        
                        <!-- Voice indicator -->
                        <div id="voiceIndicator" style="color: #ff4d6d; margin: 10px; font-weight: bold;">üé§ Ready... (press and hold to speak)</div>
                        
                        <!-- Press & Hold to Speak Button -->
                        <button id="pressToSpeakBtn" 
                                class="press-hold-btn"
                                onmousedown="startListening()" 
                                onmouseup="stopListening()" 
                                onmouseleave="stopListening()"
                                ontouchstart="startListening()" 
                                ontouchend="stopListening()">
                            üé§ PRESS & HOLD TO SPEAK
                        </button>
                        
                        <!-- Button mode container - initially hidden -->
                        <div id="buttonModeContainer" style="display: none;">
                            <div class="button-mode-container">
                                <div class="answer-row" id="answerRow1"></div>
                                <div class="answer-row" id="answerRow2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emoji shower container -->
            <div id="emojiShower" class="emoji-shower"></div>
        </div>
    </div>

    <script>
        // Game state
        let currentStage = 1;
        let voiceMode = true;
        let recognition = null;
        let recognitionActive = false;
        
        // Message arrays
        let anaMessage = "My beautiful Ana... I love you, i love you a lot, i love you the most. and ofc i love you more. you make my heart feel at home, you make my smile feel a bit warm, you make my day as pretty as you and you make live as beautiful as you, on this valentine's day i wish i get a pretty smile on your face because you deserve it all! ‚ù§Ô∏è";
        let harshMessage = "Your Harsh... The man who was just moving through life, unknown to what holds next, a bit silly, a bit confused. That found you and just cant get off you no moreeeee... (a leach if that sounds good. but a good one). The man who looks at you not as a girlfriend but as the most beautiful creation of God, and no i am not silly saying this!! üíï";
        
        // Rose Day
        let roseMessages = [
            "Message 1: The first time I saw you, yeah when i lost my breath and went god she is stunninggg...",
            "Message 2: Your smile lights up my entire world",
            "Message 3: Every moment with you is magical and the most beautiful",
            "Message 4: You make me want to be the best version of myself",
            "Message 5: I love you more, i love you more than the bad days the good days the ups and the downs. i love you more than you love me, hence i win the battle!!"
        ];
        let roseCount = 0;
        
        // Propose Day messages
        let proposeMessages = [
            "You are absolutely perfect to me",
            " I remember the day you first talked to me, it was a blessing to be able to talk to you ever since",
            "You make me the happiest person alive",
            "My most favourite person in this world is no other than you",
            "Forever is just a word, I will love you even after i die "
        ];
        
        // Chocolate Day messages (2 secrets)
        let chocolateMessages = [
            "You are the sweetest chocolate to my tongue üç´",
            "A chocolate named Ana a day keeps the Stress away üíï"
        ];
        let chocolateMessagePositions = [];
        let chocolateClicked = [];
        
        // Teddy Day
        let teddyMessages = [
            "You are perfectüß∏",
            "I'd travel any distance just to hug you",
            "You are my home",
            "I feel the best when with you or around you",
            "You are the little charm, you make this world perfect for me",
            "Your Smile is the best medicine"
        ];
        
        // Promise Day
        let promises = [
            "I promise to always listen to you, even when we're far apart.",
            "I promise to love you more and more forever.",
            "I promise to be by your side forever.",
            "I promise to always be honest with you, no matter what.",
            "I promise to bring you a world full of happiness and joy and laughs and adventures and cuddles and hugs and kissus and care and excitement!.",
            "I WILL LOVE YOU FOREVER AND EVER"
        ];
        let promiseCount = 0;
        
        // Hug Day
        let hugMessages = [
            "This hug is for all the nights we talk until sunrise ü§ó",
            "This hug is for when you're feeling down üíï",
            "This hug is just because you are perfect and you are you ‚ù§Ô∏è",
            "This hug is for all the mistakes i ever made ü•∞",
            "This hug is for the eternity, this hug is forever üíñ"
        ];
        let hugMessageCount = 0;
        let hugTaps = 0;
        let tapsNeeded = 0;
        let canTap = true;
        
        // Messages slideshow
        let slideshowMessages = [
            "I miss you on every heartbeat.",
            "You're the first person I think of when I wake up.",
            "Your name is my favorite word, it soothes the deepest scars",
            "Distance hurts but knowing it will end one day makes it worth the wait.",
            "I love you more than you love meeeeeee!",
            "You're my favorite notification, it lights up the dullest day of mine.",
            "Every love song reminds me of you.",
            "You're my home.",
            "I choose you. and i will forever choose you no matter what.",
            "Even forever sounds less when its about you"
        ];
        let currentMessageIndex = 0;
        
        // Valentine's Day Q&A
        let questions = [
            { text: "Do you oath to be truthful with your answer?", hint: "Say: 'yes' or 'no'", options: ['yes', 'no'] },
            { text: "Do you love Harsh?", hint: "Say: 'I love Harsh' or 'No I don't'", options: ['I love Harsh', 'No I don\'t'] },
            { text: "Do you think he is handsome?", hint: "Say: 'yes' or 'no'", options: ['yes', 'no'] },
            { text: "Do you think he is the right man for you?", hint: "Say: 'he is the right man' or 'Maybe'", options: ['he is the right man', 'Maybe'] },
            { text: "So would you like to be his valentine? (pretty wife)", hint: "Say: 'yes' or 'yes but bigger'", options: ['yes', 'yes but bigger'] }
        ];
        let currentQuestion = 0;
        
        // Audio control
        let song1 = document.getElementById('song1');
        let song2 = document.getElementById('song2');
        let song3 = document.getElementById('song3');
        
        // Start game
        function startGame() {
            if(song1) song1.play().catch(e => console.log("Audio play failed:", e));
            nextStage(1);
        }
        
        // Cloud transition
        function cloudTransition(fromStage, toStage) {
            let overlay = document.getElementById('cloudOverlay');
            overlay.classList.add('active');
            
            setTimeout(() => {
                goToStage(toStage);
                
                setTimeout(() => {
                    overlay.classList.remove('active');
                }, 500);
            }, 500);
        }
        
        // Go to specific stage
        function goToStage(stageNum) {
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
            let nextStage = document.getElementById(`stage${stageNum}`);
            if(nextStage) {
                nextStage.classList.add('active');
                currentStage = stageNum;
            }
        }
        
        // Next stage
        function nextStage(current) {
            goToStage(current + 1);
        }
        
        // Show message for Ana/Harsh
        function showMessage(person) {
            let box = document.getElementById(`${person}MessageBox`);
            let msg = document.getElementById(`${person}Message`);
            
            if (person === 'ana') {
                msg.textContent = anaMessage;
            } else {
                msg.textContent = harshMessage;
            }
            
            box.style.display = 'block';
        }
        
        function closeMessage(person) {
            document.getElementById(`${person}MessageBox`).style.display = 'none';
        }
        
        // Rose Day
        function waterFlowers() {
            if (roseCount < 5) {
                document.getElementById('roseMessage').textContent = roseMessages[roseCount];
                document.getElementById('rosePopup').style.display = 'block';
                document.getElementById('waterBtn').style.display = 'none';
            }
        }
        
        function continueWatering() {
            roseCount++;
            document.getElementById('rosePopup').style.display = 'none';
            
            if (roseCount < 5) {
                document.getElementById('waterBtn').style.display = 'block';
            } else {
                document.getElementById('stage13').style.backgroundImage = "url('images/rose-day/lavender-full.png')";
                document.getElementById('goldenRibbon').style.display = 'block';
                document.getElementById('nextDayBtn').style.display = 'block';
                
                // Celebration effect
                celebrateDayComplete();
            }
        }
        
        // Propose Day
        function expandMessage(num) {
            document.getElementById('expandedMessageText').textContent = proposeMessages[num-1];
            document.getElementById('expandedMessageBox').style.display = 'block';
        }
        
        function closeExpandedMessage() {
            document.getElementById('expandedMessageBox').style.display = 'none';
        }
        
        // Chocolate Day
        function initChocolateDay() {
            let grid = document.getElementById('chocolateGrid');
            if(!grid) return;
            grid.innerHTML = '';
            chocolateClicked = new Array(9).fill(false);
            
            chocolateMessagePositions = [];
            while(chocolateMessagePositions.length < 2) {
                let pos = Math.floor(Math.random() * 9);
                if(!chocolateMessagePositions.includes(pos)) {
                    chocolateMessagePositions.push(pos);
                }
            }
            
            for(let i = 0; i < 9; i++) {
                let item = document.createElement('div');
                item.className = 'grid-item';
                item.setAttribute('data-index', i);
                item.onclick = function() { clickChocolate(i); };
                grid.appendChild(item);
            }
        }
        
        function clickChocolate(index) {
            if(chocolateClicked[index]) return;
            
            chocolateClicked[index] = true;
            let element = document.querySelector(`[data-index="${index}"]`);
            
            if(chocolateMessagePositions.includes(index)) {
                element.classList.add('message');
                let msgIndex = chocolateMessagePositions.indexOf(index);
                document.getElementById('chocoMessage').textContent = chocolateMessages[msgIndex];
                document.getElementById('chocoMessageBox').style.display = 'block';
                
                // Check if all messages found
                let foundMessages = chocolateClicked.filter((clicked, i) => clicked && chocolateMessagePositions.includes(i)).length;
                if(foundMessages === 2) {
                    celebrateDayComplete();
                }
            } else {
                element.classList.add('clicked');
            }
        }
        
        function closeChocoMessage() {
            document.getElementById('chocoMessageBox').style.display = 'none';
        }
        
        // Teddy Day
        function checkPuzzle() {
            let l1 = document.getElementById('letter1').value.toUpperCase();
            let l2 = document.getElementById('letter2').value.toUpperCase();
            let l3 = document.getElementById('letter3').value.toUpperCase();
            let l4 = document.getElementById('letter4').value.toUpperCase();
            
            if(l1 === 'E' && l2 === 'R' && l3 === 'I' && l4 === 'S') {
                // Hide the puzzle completely
                document.querySelector('.word-puzzle').style.display = 'none';
                
                document.getElementById('stage16').style.backgroundImage = 'none';
                document.getElementById('teddyVideo').style.display = 'block';
                
                let container = document.getElementById('floatingMessages');
                container.style.display = 'block';
                container.innerHTML = '';
                
                let positions = [
                    { top: '5%', left: '5%' },
                    { top: '5%', right: '5%' },
                    { bottom: '5%', left: '5%' },
                    { bottom: '5%', right: '5%' },
                    { top: '50%', left: '5%', transform: 'translateY(-50%)' },
                    { top: '50%', right: '5%', transform: 'translateY(-50%)' }
                ];
                
                for(let i = 0; i < 6; i++) {
                    let msg = document.createElement('div');
                    msg.className = 'floating-message';
                    msg.textContent = teddyMessages[i];
                    
                    let pos = positions[i];
                    for(let key in pos) {
                        msg.style[key] = pos[key];
                    }
                    
                    msg.style.pointerEvents = 'none';
                    container.appendChild(msg);
                }
                
                celebrateDayComplete();
            }
        }
        
        // Promise Day - Tap image with animation
        function initPromiseDay() {
            promiseCount = 0;
            let stage17 = document.getElementById('stage17');
            
            // Remove old listener if exists
            let newStage17 = stage17.cloneNode(true);
            stage17.parentNode.replaceChild(newStage17, stage17);
            
            newStage17.addEventListener('click', function(e) {
                if(e.target.tagName !== 'BUTTON' && !e.target.closest('.message-box') && !e.target.closest('.restart-btn')) {
                    // Add tap animation
                    newStage17.classList.add('tap-effect');
                    setTimeout(() => {
                        newStage17.classList.remove('tap-effect');
                    }, 200);
                    
                    showNextPromise();
                }
            });
        }
        
        function showNextPromise() {
            if(promiseCount < promises.length) {
                document.getElementById('promiseText').textContent = promises[promiseCount];
                document.getElementById('promiseMessageBox').style.display = 'block';
                promiseCount++;
                
                if(promiseCount === promises.length) {
                    celebrateDayComplete();
                }
            }
        }
        
        function closePromiseMessage() {
            document.getElementById('promiseMessageBox').style.display = 'none';
        }
        
        // Hug Day - Anonymous tapping with animation
        function initHugDay() {
            hugMessageCount = 0;
            hugTaps = 0;
            canTap = true;
            setNewTapTarget();
            
            let stage18 = document.getElementById('stage18');
            
            // Remove old listener if exists
            let newStage18 = stage18.cloneNode(true);
            stage18.parentNode.replaceChild(newStage18, stage18);
            
            newStage18.addEventListener('click', function(e) {
                if(e.target.tagName !== 'BUTTON' && !e.target.closest('.message-box') && !e.target.closest('.restart-btn') && canTap) {
                    // Add tap animation
                    newStage18.classList.add('tap-effect');
                    setTimeout(() => {
                        newStage18.classList.remove('tap-effect');
                    }, 200);
                    
                    hugTaps++;
                    
                    if(hugTaps >= tapsNeeded && hugMessageCount < 5) {
                        showHugMessage();
                        canTap = false;
                    }
                }
            });
        }
        
        function setNewTapTarget() {
            tapsNeeded = Math.floor(Math.random() * 10) + 1;
            hugTaps = 0;
            document.getElementById('hugCounter').textContent = 'Keep tapping for hugs! ü§ó';
        }
        
        function showHugMessage() {
            document.getElementById('hugText').textContent = hugMessages[hugMessageCount];
            document.getElementById('hugMessageBox').style.display = 'block';
        }
        
        function closeHugMessage() {
            document.getElementById('hugMessageBox').style.display = 'none';
            hugMessageCount++;
            
            if(hugMessageCount < 5) {
                setNewTapTarget();
                canTap = true;
            } else {
                document.getElementById('hugCounter').textContent = 'All hugs received! ‚ù§Ô∏è';
                celebrateDayComplete();
            }
        }
        
        // Celebration effect when day is complete
        function celebrateDayComplete() {
            showerEmojis(['üéâ', '‚ú®', '‚ù§Ô∏è', 'üéä'], 30);
        }
        
        // Messages slideshow
        function nextMessage() {
            currentMessageIndex = (currentMessageIndex + 1) % slideshowMessages.length;
            document.getElementById('currentMessage').textContent = slideshowMessages[currentMessageIndex];
        }
        
        function prevMessage() {
            currentMessageIndex = (currentMessageIndex - 1 + slideshowMessages.length) % slideshowMessages.length;
            document.getElementById('currentMessage').textContent = slideshowMessages[currentMessageIndex];
        }
        
        // Start Valentine's Week
        function startValentineWeek() {
            if(song1) {
                song1.pause();
                song1.currentTime = 0;
            }
            if(song2) {
                song2.play().catch(e => console.log("Audio play failed:", e));
            }
            goToStage(13);
            initChocolateDay();
            initHugDay();
            initPromiseDay();
        }
        
        // Go to Valentine's Day finale
        function goToValentinesDay() {
            if(song2) {
                song2.pause();
                song2.currentTime = 0;
            }
            if(song3) {
                song3.play().catch(e => console.log("Audio play failed:", e));
            }
            
            let overlay = document.getElementById('cloudOverlay');
            overlay.style.background = 'black';
            overlay.classList.add('active');
            
            setTimeout(() => {
                goToStage(20);
                
                let opacity = 0.9;
                let brighten = setInterval(() => {
                    opacity -= 0.1;
                    overlay.style.background = `rgba(0,0,0,${opacity})`;
                    
                    if(opacity <= 0) {
                        clearInterval(brighten);
                        overlay.classList.remove('active');
                        overlay.style.background = '';
                        
                        // Reset questions
                        currentQuestion = 0;
                        updateQuestion();
                        
                        // Start in voice mode by default
                        voiceMode = true;
                        updateButtonMode();
                    }
                }, 100);
            }, 1000);
        }
        
        // Next day function
        function nextDay(day) {
            if(day === 13) { goToStage(14); }
            else if(day === 14) { goToStage(15); }
            else if(day === 15) { goToStage(16); }
            else if(day === 16) { goToStage(17); }
            else if(day === 17) { goToStage(18); }
            else if(day === 18) { goToStage(19); }
        }
        
        // Restart current day
        function restartCurrentDay(event) {
            let currentDay = currentStage;
            
            // Add tap animation to restart button
            event.target.classList.add('tap-effect');
            setTimeout(() => {
                event.target.classList.remove('tap-effect');
            }, 200);
            
            // Reset based on current stage
            if(currentDay === 2) { // World Map
                let video = document.querySelector('#stage2 video');
                if(video) {
                    video.currentTime = 0;
                    video.play().catch(e => console.log("Video play failed:", e));
                }
            }
            else if(currentDay === 3 || currentDay === 5 || currentDay === 7) { // Cloud covers
                // Just stay on same stage
            }
            else if(currentDay === 4) { // Ana pic
                document.getElementById('anaMessageBox').style.display = 'none';
            }
            else if(currentDay === 6) { // India map
                let video = document.querySelector('#stage6 video');
                if(video) {
                    video.currentTime = 0;
                    video.play().catch(e => console.log("Video play failed:", e));
                }
            }
            else if(currentDay === 8) { // Harsh pic
                document.getElementById('harshMessageBox').style.display = 'none';
            }
            else if(currentDay === 9 || currentDay === 10) { // WOS, Batman
                // Nothing to reset
            }
            else if(currentDay === 11) { // Heartbeat
                // Nothing to reset
            }
            else if(currentDay === 12) { // Messages slideshow
                currentMessageIndex = 0;
                document.getElementById('currentMessage').textContent = slideshowMessages[0];
            }
            else if(currentDay === 13) { // Rose Day
                roseCount = 0;
                document.getElementById('stage13').style.backgroundImage = "url('images/rose-day/lavender-empty.png')";
                document.getElementById('waterBtn').style.display = 'block';
                document.getElementById('goldenRibbon').style.display = 'none';
                document.getElementById('nextDayBtn').style.display = 'none';
                document.getElementById('rosePopup').style.display = 'none';
            }
            else if(currentDay === 14) { // Propose Day
                document.getElementById('expandedMessageBox').style.display = 'none';
            }
            else if(currentDay === 15) { // Chocolate Day
                initChocolateDay();
                document.getElementById('chocoMessageBox').style.display = 'none';
            }
            else if(currentDay === 16) { // Teddy Day
                document.getElementById('stage16').style.backgroundImage = "url('images/teddy-day/teddy.png')";
                document.getElementById('teddyVideo').style.display = 'none';
                document.getElementById('floatingMessages').style.display = 'none';
                let puzzle = document.querySelector('.word-puzzle');
                if(puzzle) puzzle.style.display = 'block';
                document.getElementById('letter1').value = '';
                document.getElementById('letter2').value = '';
                document.getElementById('letter3').value = '';
                document.getElementById('letter4').value = '';
            }
            else if(currentDay === 17) { // Promise Day
                promiseCount = 0;
                document.getElementById('promiseMessageBox').style.display = 'none';
            }
            else if(currentDay === 18) { // Hug Day
                hugMessageCount = 0;
                hugTaps = 0;
                canTap = true;
                setNewTapTarget();
                document.getElementById('hugMessageBox').style.display = 'none';
            }
            else if(currentDay === 19) { // Kiss Day
                // Nothing to reset
            }
            else if(currentDay === 20) { // Valentine's Day Q&A
                currentQuestion = 0;
                updateQuestion();
                // Restart voice recognition
                if(recognition) {
                    try { recognition.stop(); } catch(e) {}
                }
                voiceMode = true;
                updateButtonMode();
            }
        }
        
        // Press & Hold Voice Functions
        function startListening() {
            if (!voiceMode) return;
            
            // Pause music
            if (song3) {
                song3.pause();
            }
            
            // Visual feedback
            let btn = document.getElementById('pressToSpeakBtn');
            btn.classList.add('listening');
            btn.textContent = 'üé§ LISTENING... SPEAK NOW';
            
            document.getElementById('voiceIndicator').innerHTML = 'üé§ Listening... (speak now)';
            
            // Start voice recognition
            startVoiceRecognitionOnce();
        }

        function stopListening() {
            if (!voiceMode) return;
            
            // Resume music
            if (song3) {
                song3.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Reset button
            let btn = document.getElementById('pressToSpeakBtn');
            btn.classList.remove('listening');
            btn.textContent = 'üé§ PRESS & HOLD TO SPEAK';
            
            document.getElementById('voiceIndicator').innerHTML = 'üé§ Ready... (press and hold to speak)';
            
            // Stop voice recognition
            if (recognition) {
                try {
                    recognition.stop();
                } catch (e) {}
            }
        }

        function startVoiceRecognitionOnce() {
            if (!voiceMode) return;
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice recognition not supported in this browser. Please use button mode.');
                voiceMode = false;
                updateButtonMode();
                return;
            }
            
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                
                recognition.onresult = function(event) {
                    let transcript = event.results[0][0].transcript.toLowerCase().trim();
                    console.log("Heard:", transcript);
                    document.getElementById('voiceIndicator').innerHTML = 'üé§ Heard: "' + transcript + '"';
                    
                    // Process the transcript
                    handleVoiceInput(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.log("Voice error:", event.error);
                    if (event.error === 'no-speech') {
                        document.getElementById('voiceIndicator').innerHTML = 'üé§ No speech detected, try again...';
                    } else if (event.error === 'not-allowed') {
                        document.getElementById('voiceIndicator').innerHTML = '‚ùå Microphone access denied';
                        // Auto-switch to button mode
                        setTimeout(() => {
                            if (voiceMode) {
                                voiceMode = false;
                                updateButtonMode();
                            }
                        }, 2000);
                    }
                };
                
                recognition.onend = function() {
                    console.log("Recognition ended");
                    // Don't auto-restart - user needs to press button again
                };
                
                recognition.start();
                
            } catch (e) {
                console.error("Voice recognition error:", e);
            }
        }
        
        // Voice recognition functions
        function toggleMode() {
            voiceMode = !voiceMode;
            updateButtonMode();
            
            // Stop any ongoing recognition
            if (recognition) {
                try { recognition.stop(); } catch(e) {}
            }
            
            // Resume music if it was paused
            if (song3 && voiceMode) {
                song3.play().catch(e => console.log("Audio play failed:", e));
            }
        }
        
        function updateButtonMode() {
            let modeToggle = document.getElementById('modeToggle');
            let voiceIndicator = document.getElementById('voiceIndicator');
            let buttonContainer = document.getElementById('buttonModeContainer');
            let pressBtn = document.getElementById('pressToSpeakBtn');
            
            if (voiceMode) {
                modeToggle.textContent = 'üëÜ Switch to Button Mode';
                modeToggle.style.background = '#4CAF50';
                if (voiceIndicator) {
                    voiceIndicator.style.display = 'block';
                    voiceIndicator.innerHTML = 'üé§ Ready... (press and hold to speak)';
                }
                if (buttonContainer) buttonContainer.style.display = 'none';
                if (pressBtn) pressBtn.style.display = 'block';
                
                // Resume music
                if (song3) {
                    song3.play().catch(e => console.log("Audio play failed:", e));
                }
            } else {
                modeToggle.textContent = 'üé§ Switch to Voice Mode';
                modeToggle.style.background = '#ff4d6d';
                if (voiceIndicator) voiceIndicator.style.display = 'none';
                if (buttonContainer) {
                    buttonContainer.style.display = 'block';
                    populateButtons();
                }
                if (pressBtn) pressBtn.style.display = 'none';
                
                // Ensure music is playing for button mode
                if (song3) {
                    song3.play().catch(e => console.log("Audio play failed:", e));
                }
            }
        }
        
        function populateButtons() {
            if(currentQuestion >= questions.length) return;
            
            let row1 = document.getElementById('answerRow1');
            let row2 = document.getElementById('answerRow2');
            
            if(!row1 || !row2) return;
            
            row1.innerHTML = '';
            row2.innerHTML = '';
            
            let options = questions[currentQuestion].options;
            
            // Split options into rows (max 2 per row)
            options.forEach((opt, index) => {
                let button = document.createElement('button');
                button.className = 'btn-small';
                button.textContent = opt;
                button.onclick = function() { 
                    handleButtonAnswer(opt);
                    // Add tap effect
                    button.classList.add('tap-effect');
                    setTimeout(() => button.classList.remove('tap-effect'), 200);
                };
                button.style.margin = '5px';
                button.style.minWidth = '120px';
                
                if(index < 2) {
                    row1.appendChild(button);
                } else {
                    row2.appendChild(button);
                }
            });
        }
        
        function handleButtonAnswer(answer) {
            // Convert button answer to the format handleAnswer expects
            if(currentQuestion === 0) {
                if(answer.toLowerCase() === 'yes') handleAnswer('yes');
                else if(answer.toLowerCase() === 'no') handleAnswer('no');
            }
            else if(currentQuestion === 1) {
                if(answer === 'I love Harsh') handleAnswer('i love harsh');
                else if(answer === 'No I don\'t') handleAnswer('no i dont');
            }
            else if(currentQuestion === 2) {
                if(answer.toLowerCase() === 'yes') handleAnswer('yes');
                else if(answer.toLowerCase() === 'no') handleAnswer('no');
            }
            else if(currentQuestion === 3) {
                if(answer === 'he is the right man') handleAnswer('he is the right man');
                else if(answer === 'Maybe') handleAnswer('maybe');
            }
            else if(currentQuestion === 4) {
                if(answer === 'yes but bigger') handleAnswer('yes but bigger');
                else if(answer.toLowerCase() === 'yes') handleAnswer('yes');
            }
        }
        
        function handleVoiceInput(input) {
            if(!voiceMode) return;
            
            if(currentQuestion === 0) {
                if(input.includes('yes')) {
                    handleAnswer('yes');
                } else if(input.includes('no')) {
                    handleAnswer('no');
                }
            } else if(currentQuestion === 1) {
                if(input.includes('i love harsh') || (input.includes('i') && input.includes('love') && input.includes('harsh'))) {
                    handleAnswer('i love harsh');
                } else if(input.includes('no')) {
                    handleAnswer('no i dont');
                }
            } else if(currentQuestion === 2) {
                if(input.includes('yes')) {
                    handleAnswer('yes');
                } else if(input.includes('no')) {
                    handleAnswer('no');
                }
            } else if(currentQuestion === 3) {
                if(input.includes('he is the right man') || (input.includes('right') && input.includes('man'))) {
                    handleAnswer('he is the right man');
                } else if(input.includes('maybe')) {
                    handleAnswer('maybe');
                }
            } else if(currentQuestion === 4) {
                if(input.includes('yes but bigger')) {
                    handleAnswer('yes but bigger');
                } else if(input.includes('yes')) {
                    handleAnswer('yes');
                }
            }
        }
        
        function handleAnswer(answer) {
            console.log("Answer:", answer, "Question:", currentQuestion);
            
            // Stop recognition for a moment
            if(recognition && voiceMode) {
                try { recognition.stop(); } catch(e) {}
            }
            
            if(answer === 'yes' && currentQuestion === 0) {
                showerEmojis(['‚úÖ'], 20);
                currentQuestion++;
                updateQuestion();
            } else if(answer === 'no' && currentQuestion === 0) {
                showerEmojis(['üëë', 'üòà'], 30);
                showMessageBox("Get on your knees bitchhhhhhhhhhh!!");
            } else if(answer === 'i love harsh' && currentQuestion === 1) {
                showerEmojis(['‚ù§Ô∏è', 'üíï', 'üíñ'], 50);
                currentQuestion++;
                updateQuestion();
            } else if(answer === 'no i dont' && currentQuestion === 1) {
                showerEmojis(['üò¢', 'üò≠', 'üíî'], 40);
                showMessageBox("üíî");
            } else if(answer === 'yes' && currentQuestion === 2) {
                showerEmojis(['üòä', 'ü•∞', 'üíï'], 40);
                currentQuestion++;
                updateQuestion();
            } else if(answer === 'no' && currentQuestion === 2) {
                showerEmojis(['üçÜ', 'üíß', 'üçë', 'üçÜ', 'üíß', 'üçë'], 60);
                showMessageBox("üòà");
            } else if(answer === 'he is the right man' && currentQuestion === 3) {
                showerEmojis(['üòâ', 'üíï', '‚ú®'], 40);
                currentQuestion++;
                updateQuestion();
            } else if(answer === 'maybe' && currentQuestion === 3) {
                showerEmojis(['üî´', 'üî´', 'üî´'], 30);
                showMessageBox("on your knees now!!!");
            } else if(answer === 'yes' && currentQuestion === 4) {
                showerEmojis(['üíã', '‚ù§Ô∏è', 'üéâ', 'üíã', '‚ù§Ô∏è', 'üéâ'], 60);
                showFinale();
            } else if(answer === 'yes but bigger' && currentQuestion === 4) {
                showerEmojis(['üéâ', 'üéä', '‚ú®', 'üíñ', 'ü•≥', 'üéà'], 100);
                showFinale();
            }
        }
        
        function updateQuestion() {
            if(currentQuestion < questions.length) {
                document.getElementById('questionText').textContent = questions[currentQuestion].text;
                document.getElementById('answerHint').textContent = questions[currentQuestion].hint;
                
                // Update buttons if in button mode
                if(!voiceMode) {
                    populateButtons();
                }
            }
        }
        
        function showFinale() {
            // First show HAPPY VALENTINE'S DAY message
            document.getElementById('questionBox').innerHTML = `
                <h2 style="color: #ff4d6d; text-align: center; font-size: 32px;">‚ù§Ô∏è Feli√ß dia de Sant Valent√≠, m√≥n meu ‚ù§Ô∏è</h2>
                <p style="font-size: 20px; text-align: center; margin: 20px 0;">Wait for it...</p>
            `;
            
            // Fireworks immediately
            for(let i = 0; i < 200; i++) {
                setTimeout(() => {
                    showerEmojis(['üéÜ', '‚ú®', 'üí•', '‚ù§Ô∏è'], 1);
                }, i * 50);
            }
            
            // Wait 3.5 seconds then show ring
            setTimeout(() => {
                document.getElementById('questionBox').innerHTML = `
                    <h2 style="color: #ff4d6d; text-align: center;">‚ù§Ô∏è Feli√ß dia de Sant Valent√≠, m√≥n meu ‚ù§Ô∏è</h2>
                    <div style="text-align: center; margin: 20px 0;">
                        <img src="images/ring.png" style="max-width: 100%; border-radius: 20px;" alt="Ring">
                    </div>
                    <p style="font-size: 24px; text-align: center;">Today. Tomorrow. Forever.</p>
                    <p style="font-size: 18px; text-align: center;">Te Quiero Anabel! ‚ù§Ô∏è</p>
                `;
            }, 3500);
        }
        
        function showMessageBox(msg) {
            document.getElementById('questionText').innerHTML = msg;
            setTimeout(() => {
                updateQuestion();
            }, 2000);
        }
        
        function showerEmojis(emojis, count) {
            let container = document.getElementById('emojiShower');
            
            for(let i = 0; i < count; i++) {
                setTimeout(() => {
                    let emoji = document.createElement('div');
                    emoji.className = 'emoji';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = Math.random() * 100 + '%';
                    emoji.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    emoji.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    emoji.style.opacity = Math.random() * 0.8 + 0.2;
                    
                    container.appendChild(emoji);
                    
                    setTimeout(() => {
                        emoji.remove();
                    }, 3000);
                }, i * 50);
            }
        }
        
        // Initialize
        window.onload = function() {
            document.getElementById('currentMessage').textContent = slideshowMessages[0];
            let buttonDiv = document.getElementById('buttonAnswers');
            if(buttonDiv) buttonDiv.style.display = 'none';
            
            // Initialize button mode container
            let buttonContainer = document.getElementById('buttonModeContainer');
            if(buttonContainer) buttonContainer.style.display = 'none';
        };
    </script>
</body>
</html>